<!DOCTYPE html>
<html>
<head>
    <title>AeroScout Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .card {
            background: white;
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .defect-card {
            border-left: 4px solid #e74c3c;
            background: #ffe6e6;
        }
        .mission-card {
            border-left: 4px solid #3498db;
            background: #e6f7ff;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            text-align: center;
            padding: 20px;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
        }
        .stat-label {
            color: #7f8c8d;
            margin-top: 5px;
        }
        .error {
            background: #ffebee;
            color: #c62828;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .loading {
            text-align: center;
            color: #7f8c8d;
            padding: 20px;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
        }
        h2 {
            color: #34495e;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÅ AeroScout Dashboard</h1>

        <div class="stats-grid" id="stats">
            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</div>
        </div>

        <h2>üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ –º–∏—Å—Å–∏–∏</h2>
        <div id="missions">
            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –º–∏—Å—Å–∏–π...</div>
        </div>

        <h2>üîç –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–µ—Ñ–µ–∫—Ç—ã</h2>
        <div id="defects">
            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–µ—Ñ–µ–∫—Ç–æ–≤...</div>
        </div>
    </div>

    <script>
        // üîß –ù–ê–°–¢–†–û–ô–ö–ê: –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à URL API
        const API_BASE_URL = 'http://localhost:8000/api';
        // –ò–õ–ò –¥–ª—è –æ–Ω–ª–∞–π–Ω –≤–µ—Ä—Å–∏–∏:
        // const API_BASE_URL = 'https://your-backend.herokuapp.com/api';

        // üìä –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –µ—Å–ª–∏ API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ)
        const mockData = {
            stats: {
                total_missions: 12,
                total_defects: 34,
                total_flight_hours: 6.5,
                defects_by_type: {
                    crack: 18,
                    rust: 16
                }
            },
            missions: [
                {
                    mission_id: "mission_001",
                    drone_id: "pioneer_001",
                    location: "–°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–∞—è –ø–ª–æ—â–∞–¥–∫–∞ ‚Ññ1",
                    total_images: 45,
                    defects_found: 3,
                    flight_duration: 1250,
                    created_at: "2024-01-15T10:30:00"
                },
                {
                    mission_id: "mission_002",
                    drone_id: "pioneer_001",
                    location: "–ú–æ—Å—Ç —á–µ—Ä–µ–∑ —Ä–µ–∫—É",
                    total_images: 67,
                    defects_found: 7,
                    flight_duration: 1850,
                    created_at: "2024-01-14T14:20:00"
                }
            ],
            defects: [
                {
                    defect_id: "defect_001",
                    defect_type: "crack",
                    confidence: 0.87,
                    location: "55.7558, 37.6173",
                    timestamp: "2024-01-15T10:45:00"
                },
                {
                    defect_id: "defect_002",
                    defect_type: "rust",
                    confidence: 0.92,
                    location: "55.7559, 37.6174",
                    timestamp: "2024-01-15T10:47:00"
                }
            ]
        };

        // üöÄ –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        async function loadData() {
            try {
                console.log("üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å API...");

                // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å API
                const [statsResponse, missionsResponse, defectsResponse] = await Promise.all([
                    fetch(API_BASE_URL + '/stats').catch(() => null),
                    fetch(API_BASE_URL + '/missions?limit=5').catch(() => null),
                    fetch(API_BASE_URL + '/defects?limit=10').catch(() => null)
                ]);

                let stats, missions, defects;

                // –ï—Å–ª–∏ API –¥–æ—Å—Ç—É–ø–Ω–æ - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                if (statsResponse && statsResponse.ok) {
                    stats = await statsResponse.json();
                    console.log("‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —Å API");
                } else {
                    stats = mockData.stats;
                    console.log("‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)");
                }

                if (missionsResponse && missionsResponse.ok) {
                    const missionsData = await missionsResponse.json();
                    missions = missionsData.missions || [];
                    console.log("‚úÖ –ú–∏—Å—Å–∏–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å API");
                } else {
                    missions = mockData.missions;
                    console.log("‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–º–∏—Å—Å–∏–∏)");
                }

                if (defectsResponse && defectsResponse.ok) {
                    const defectsData = await defectsResponse.json();
                    defects = defectsData.defects || [];
                    console.log("‚úÖ –î–µ—Ñ–µ–∫—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å API");
                } else {
                    defects = mockData.defects;
                    console.log("‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–¥–µ—Ñ–µ–∫—Ç—ã)");
                }

                // –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                renderStats(stats);
                renderMissions(missions);
                renderDefects(defects);

            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);

                // –ï—Å–ª–∏ –≤—Å–µ —É–ø–∞–ª–æ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                renderStats(mockData.stats);
                renderMissions(mockData.missions);
                renderDefects(mockData.defects);

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
                showError('API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ. –ü–æ–∫–∞–∑–∞–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ.');
            }
        }

        // üìà –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function renderStats(stats) {
            const statsContainer = document.getElementById('stats');

            if (!stats) {
                statsContainer.innerHTML = '<div class="error">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</div>';
                return;
            }

            statsContainer.innerHTML = `
                <div class="card stat-card">
                    <div class="stat-number">${stats.total_missions || 0}</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –º–∏—Å—Å–∏–π</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-number">${stats.total_defects || 0}</div>
                    <div class="stat-label">–ù–∞–π–¥–µ–Ω–æ –¥–µ—Ñ–µ–∫—Ç–æ–≤</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-number">${stats.total_flight_hours || 0}</div>
                    <div class="stat-label">–ß–∞—Å–æ–≤ –ø–æ–ª—ë—Ç–∞</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-number">${stats.defects_by_type?.crack || 0}</div>
                    <div class="stat-label">–¢—Ä–µ—â–∏–Ω –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-number">${stats.defects_by_type?.rust || 0}</div>
                    <div class="stat-label">–£—á–∞—Å—Ç–∫–æ–≤ —Ä–∂–∞–≤—á–∏–Ω—ã</div>
                </div>
            `;
        }

        // üìã –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –º–∏—Å—Å–∏–π
        function renderMissions(missions) {
            const missionsContainer = document.getElementById('missions');

            if (!missions || missions.length === 0) {
                missionsContainer.innerHTML = '<div class="card">–ú–∏—Å—Å–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                return;
            }

            missionsContainer.innerHTML = missions.map(mission => `
                <div class="card mission-card">
                    <strong>–ú–∏—Å—Å–∏—è: ${mission.mission_id}</strong><br>
                    <strong>–î—Ä–æ–Ω:</strong> ${mission.drone_id} |
                    <strong>–õ–æ–∫–∞—Ü–∏—è:</strong> ${mission.location}<br>
                    <strong>–°–Ω–∏–º–∫–æ–≤:</strong> ${mission.total_images} |
                    <strong>–î–µ—Ñ–µ–∫—Ç–æ–≤:</strong> ${mission.defects_found}<br>
                    <strong>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</strong> ${mission.flight_duration ? Math.round(mission.flight_duration/60) + ' –º–∏–Ω' : 'N/A'} |
                    <strong>–î–∞—Ç–∞:</strong> ${new Date(mission.created_at).toLocaleString()}
                </div>
            `).join('');
        }

        // üîç –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –¥–µ—Ñ–µ–∫—Ç–æ–≤
        function renderDefects(defects) {
            const defectsContainer = document.getElementById('defects');

            if (!defects || defects.length === 0) {
                defectsContainer.innerHTML = '<div class="card">–î–µ—Ñ–µ–∫—Ç—ã –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã</div>';
                return;
            }

            defectsContainer.innerHTML = defects.map(defect => `
                <div class="card defect-card">
                    <strong>–¢–∏–ø –¥–µ—Ñ–µ–∫—Ç–∞: ${defect.defect_type === 'crack' ? '–¢–†–ï–©–ò–ù–ê' : '–†–ñ–ê–í–ß–ò–ù–ê'}</strong><br>
                    <strong>–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å:</strong> ${(defect.confidence * 100).toFixed(1)}%<br>
                    <strong>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:</strong> ${defect.location}<br>
                    <strong>–í—Ä–µ–º—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è:</strong> ${new Date(defect.timestamp).toLocaleString()}
                </div>
            `).join('');
        }

        // ‚ùå –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
        function showError(message) {
            // –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –Ω–∞—Ö–æ–¥–∏–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –æ—à–∏–±–æ–∫
            let errorContainer = document.getElementById('error-message');
            if (!errorContainer) {
                errorContainer = document.createElement('div');
                errorContainer.id = 'error-message';
                document.body.prepend(errorContainer);
            }

            errorContainer.innerHTML = `<div class="error">‚ö†Ô∏è ${message}</div>`;

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                errorContainer.innerHTML = '';
            }, 5000);
        }

        // üéØ –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            console.log("üöÄ AeroScout Dashboard –∑–∞–ø—É—â–µ–Ω!");
            loadData(); // –ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞

            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
            setInterval(loadData, 10000);
        });
    </script>
</body>
</html>